
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>WeUI</title>
    <!-- 引入 WeUI -->
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css"/>
</head>
<body>
<div class="page">
    <div class="page__bd">
        <div class="weui-tab">
            <div class="weui-navbar">
                <div class="weui-navbar__item weui-bar__item_on">待办</div>
                <div class="weui-navbar__item">已完成</div>
            </div>
            <div class="weui-tab__panel">

            </div>
        </div>
        <div class="weui_panel weui_panel_access">
          <!--  <div class="weui_panel_hd">任务列表</div>-->
            <div class="weui_panel_bd js-blog-list">

            </div>
        </div>
        <div class="js-load-more">加载更多</div>
    </div>
</div>
<script src="../public/libs/jquery.min.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.0.0/weui.min.js"></script>
<style>
    .js-load-more{
        padding:0 15px;
        width:120px;
        height:30px;
        background-color:#D31733;
        color:#fff;
        line-height:30px;
        text-align:center;
        border-radius:5px;
        margin:20px auto;
        border:0 none;
        font-size:16px;
        display:none;/*默认不显示，ajax调用成功后才决定显示与否*/
    }
</style>
<script type="text/javascript">
    $(function(){
        var status=0;
        $('.weui-navbar__item').on('click', function () {
            var text=$(this).text();

            if(text=='待办'){
                status=0;
                $('.js-blog-list').empty();
                getData(counter, pageSize,status);
            }else if(text=='已完成'){
                status=1;
                $('.js-blog-list').empty();
                getData(counter, pageSize,status);
            }
            $(this).addClass('weui-bar__item_on').siblings('.weui-bar__item_on').removeClass('weui-bar__item_on');
        });
        /*初始化*/
        var counter = 1; /*第几页*/
        var pageSize = 4; /*size*/
        /*首次加载*/
        getData(counter, pageSize,status);
        /*监听加载更多*/
        $(document).on('click', '.js-load-more', function(){
            counter ++;
            getData(counter, pageSize,status);
        });
    });
    function jump(id){
        localStorage.id=id;
        location.href="../charge/chargehandleh5.html";
    }
    function getData(page,size,status){
        console.log("status==>"+status);
        var tipImage="";
        if(status==0){
            tipImage='<i class="weui-icon-info-circle"></i>';
        }else{
            tipImage='<i class="weui-icon-success"></i>';
        }
        $.ajax({
            type: 'POST',
            url: '../task/list',
            data:{page:page,limit:size,status:status,order:"createDate"},
            dataType: 'json',
            success: function(reponse){
                var data = reponse.page.list;
                var totalPage = reponse.page.totalPage;
                var currPage=reponse.page.currPage;
                console.log(totalPage+","+currPage);
                var result = '';
                /*使用for循环模拟SQL里的limit(offset,size)*/
                for(var i=0; i<data.length; i++){
                    result +='<a class="weui-cell weui-cell_access" href="javascript:void(0)" onclick="jump('+data[i].id+')">' +
                        '<div class="weui-cell__hd">'+tipImage+'</div>'+
                        '<div class="weui-cell__bd"><p>'+data[i].userName+'&nbsp;&nbsp;&nbsp;欠费金额&nbsp;'+data[i].amount+'</p></div><div class="weui-cell__ft"></div></a>';
                }
                $('.js-blog-list').append(result);
                /*******************************************/
                /*隐藏more按钮*/
                if ( currPage >= totalPage){
                    $(".js-load-more").hide();
                }else{
                    $(".js-load-more").show();
                }
            },
            error: function(xhr, type){
                alert('Ajax error!');
            }
        });
    }
</script>
</body>
</html>